# TrainingLoop - –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

## üìã –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `src/training/train_loop.py` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¥–ª—è RL –∞–≥–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—É—á–µ–Ω–∏—è, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **TrainingLoop** - –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
2. **TrainingProgress** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è
3. **TrainingStatistics** - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è
4. **ProgressReporter** - –†–µ–ø–æ—Ä—Ç–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å TensorBoard
5. **–•—É–∫–∏ –æ–±—É—á–µ–Ω–∏—è** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ callbacks

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—É—á–µ–Ω–∏—è

- **EPISODIC** - –û–±—É—á–µ–Ω–∏–µ –ø–æ —ç–ø–∏–∑–æ–¥–∞–º
- **TIMESTEP_BASED** - –û–±—É—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —à–∞–≥–∞–º
- **MIXED** - –°–º–µ—à–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **ADAPTIVE** - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: 1,267
- **–ö–ª–∞—Å—Å–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π**: 74
- **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã**: 8
- **–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è**: 2
- **–•—É–∫–∏**: 2 –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
```python
progress = TrainingProgress()
progress.update_performance_stats(current_time)
progress.update_resource_usage()
```

### 2. –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—É—á–µ–Ω–∏—è
```python
training_loop = TrainingLoop(
    agent=agent,
    env=env,
    strategy=TrainingStrategy.ADAPTIVE,
    total_timesteps=100_000
)
```

### 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö—É–∫–∏
```python
class CustomHook:
    def on_training_start(self, progress): pass
    def on_step(self, progress, step_info): pass
    def on_episode_end(self, progress, episode_info): pass

training_loop.add_hook(CustomHook())
```

### 4. Graceful shutdown
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ SIGINT/SIGTERM
training_loop.stop()  # –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
training_loop.pause() # –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞
training_loop.resume() # –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏, CPU, GPU
training_loop = TrainingLoop(
    memory_limit_mb=500.0,
    convergence_threshold=200.0
)
```

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### TensorBoard
```python
reporter = ProgressReporter(
    tensorboard_log_dir="logs/tensorboard"
)
```

### –ú–µ—Ç—Ä–∏–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `MetricsTracker`
- –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON/CSV
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤

### –ß–µ–∫–ø–æ–∏–Ω—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```python
config = {
    "strategy": "adaptive",
    "total_timesteps": 100_000,
    "eval_freq": 10_000,
    "checkpoint_freq": 25_000,
    "memory_limit_mb": 500.0,
    "enable_early_stopping": True,
    "tensorboard_log_dir": "logs/tb"
}

training_loop = create_training_loop(agent, env, config)
```

## üìã –ö–ª–∞—Å—Å—ã –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

### TrainingProgress
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—à–∞–≥–æ–≤/—Å–µ–∫, —ç–ø–∏–∑–æ–¥–æ–≤/–º–∏–Ω)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–∞–º—è—Ç—å, CPU, GPU)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–ø–∏–∑–æ–¥–æ–≤

### TrainingStatistics
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è

### ProgressReporter
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TensorBoard
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

### TrainingLoop
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üéØ –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ö—É–∫–∏

### LoggingHook
```python
hook = LoggingHook(log_interval=1000)
training_loop.add_hook(hook)
```

### EarlyStoppingHook
```python
hook = EarlyStoppingHook(
    patience=10,
    min_improvement=0.01
)
training_loop.add_hook(hook)
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. **–ù–∞—á–∞–ª–æ –æ–±—É—á–µ–Ω–∏—è** - –í—ã–∑–æ–≤ —Ö—É–∫–æ–≤ `on_training_start`
3. **–¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è** - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –º–µ—Ç—Ä–∏–∫
5. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –û—Ü–µ–Ω–∫–∞, —á–µ–∫–ø–æ–∏–Ω—Ç—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** - –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–º–æ—Ç—Ä–∏—Ç–µ `examples/train_loop_usage.py` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:

- –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –≠–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –†–∞–Ω–Ω–∏–π –æ—Å—Ç–∞–Ω–æ–≤
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:
- `tests/test_train_loop.py` - –ü–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- `tests/test_train_loop_simple.py` - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º

–ú–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å:
- `src.agents` - RL –∞–≥–µ–Ω—Ç—ã
- `src.utils.metrics` - –°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫
- `src.utils.logging` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `src.utils.checkpointing` - –ß–µ–∫–ø–æ–∏–Ω—Ç—ã
- `src.training.trainer` - –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ç—Ä–µ–Ω–µ—Ä

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `gymnasium` - –°—Ä–µ–¥—ã RL
- `stable_baselines3` - RL –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- `torch` - PyTorch –¥–ª—è GPU
- `psutil` - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
- `tensorboard` - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- `numpy` - –ß–∏—Å–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- `matplotlib` - –ì—Ä–∞—Ñ–∏–∫–∏

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

TrainingLoop –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—É—é –∏ –≥–∏–±–∫—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ–±—É—á–µ–Ω–∏—è RL –∞–≥–µ–Ω—Ç–æ–≤ —Å:

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—É—á–µ–Ω–∏—è
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Graceful shutdown –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–∞–º–∏
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö—É–∫–∏
- ‚úÖ –ü–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–æ–µ–∫—Ç–∞

–ú–æ–¥—É–ª—å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è RL –∞–≥–µ–Ω—Ç–æ–≤.