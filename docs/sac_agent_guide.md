# SAC Agent - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## –û–±–∑–æ—Ä

SAC (Soft Actor-Critic) –∞–≥–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –≤ **–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö –¥–µ–π—Å—Ç–≤–∏–π**. –≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º off-policy, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—é —ç–Ω—Ç—Ä–æ–ø–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å—Ä–µ–¥—ã.

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ä–µ–¥—ã
- **–¢–æ–ª—å–∫–æ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π** (Box)
- LunarLander-v3 (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- Pendulum-v1
- BipedalWalker-v3
- MountainCarContinuous-v0

### ‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ä–µ–¥—ã
- –î–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π (Discrete)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PPO, A2C –∏–ª–∏ DQN –¥–ª—è –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ä–µ–¥

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–Ω—Ç—Ä–æ–ø–∏–∏** (`ent_coef="auto"`)
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ learning rate**
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏–π**
- **–®—É–º –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è** (Normal, Ornstein-Uhlenbeck)
- **–†–∞–Ω–Ω—è—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—É—á–µ–Ω–∏—è**
- **–î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤**

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from src.agents import SACAgent, SACConfig

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = SACConfig(
    env_name="Pendulum-v1",
    total_timesteps=50_000,
    learning_rate=3e-4,
    buffer_size=200_000,
    batch_size=256,
)

# –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
agent = SACAgent(config=config)
result = agent.train()

# –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
metrics = agent.evaluate(n_episodes=10)
print(f"–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä–∞–¥–∞: {metrics['mean_reward']:.2f}")
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º

```python
from src.utils import load_config
from src.agents import SACAgent, SACConfig

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ YAML
config_dict = load_config("configs/sac_config.yaml")
config = SACConfig(**config_dict)

# –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
agent = SACAgent(config=config)
```

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏

```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
agent.save("./models/my_sac_model.zip")

# –ó–∞–≥—Ä—É–∑–∫–∞
loaded_agent = SACAgent.load("./models/my_sac_model.zip")
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```python
config = SACConfig(
    # –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    env_name="LunarLander-v3",
    total_timesteps=100_000,
    seed=42,
    
    # SAC-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    learning_rate=3e-4,
    buffer_size=1_000_000,
    learning_starts=10_000,
    batch_size=256,
    tau=0.005,  # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º—è–≥–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    gamma=0.99,
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–Ω—Ç—Ä–æ–ø–∏–∏
    ent_coef="auto",  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    target_entropy="auto",
    
    # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ç–∏
    net_arch=[256, 256],
    activation_fn="relu",
)
```

### –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥

#### LunarLander-v3
```python
config = SACConfig(
    env_name="LunarLander-v3",
    learning_rate=3e-4,
    buffer_size=1_000_000,
    batch_size=256,
    tau=0.005,
    target_reward=200.0,
)
```

#### Pendulum-v1
```python
config = SACConfig(
    env_name="Pendulum-v1",
    learning_rate=1e-3,
    buffer_size=200_000,
    batch_size=256,
    tau=0.02,
    target_reward=-200.0,
    action_noise_type="normal",
    action_noise_std=0.1,
)
```

#### BipedalWalker-v3
```python
config = SACConfig(
    env_name="BipedalWalker-v3",
    total_timesteps=1_000_000,
    learning_rate=3e-4,
    buffer_size=1_000_000,
    net_arch=[400, 300],
    target_reward=300.0,
)
```

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–ª–±—ç–∫–∏

```python
from stable_baselines3.common.callbacks import BaseCallback

class CustomCallback(BaseCallback):
    def _on_step(self) -> bool:
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
        return True

agent = SACAgent(config=config)
result = agent.train(callback=CustomCallback())
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—É–º–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

```python
config = SACConfig(
    env_name="Pendulum-v1",
    action_noise_type="normal",  # "normal" –∏–ª–∏ "ornstein_uhlenbeck"
    action_noise_std=0.1,
)
```

### 3. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ learning rate

```python
config = SACConfig(
    env_name="LunarLander-v3",
    use_lr_schedule=True,
    lr_schedule_type="linear",  # "linear", "exponential"
    lr_final_ratio=0.1,
)
```

### 4. –†–∞–Ω–Ω—è—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

```python
config = SACConfig(
    env_name="LunarLander-v3",
    early_stopping=True,
    target_reward=200.0,
    patience_episodes=100,
    min_improvement=5.0,
)
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### TensorBoard

```python
config = SACConfig(
    env_name="LunarLander-v3",
    use_tensorboard=True,
    tensorboard_log="./logs/sac_experiment",
)

# –ó–∞–ø—É—Å–∫ TensorBoard
# tensorboard --logdir ./logs/sac_experiment
```

### –ú–µ—Ç—Ä–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è

SAC –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
- –ù–∞–≥—Ä–∞–¥—ã —ç–ø–∏–∑–æ–¥–æ–≤
- –î–ª–∏–Ω—ã —ç–ø–∏–∑–æ–¥–æ–≤  
- Actor loss
- Critic loss
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç–Ω—Ç—Ä–æ–ø–∏–∏
- Learning rate

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏

```python
info = agent.get_model_info()
print(f"–ê–ª–≥–æ—Ä–∏—Ç–º: {info['algorithm']}")
print(f"–†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞: {info['buffer_size']}")
print(f"–§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞: {info['final_mean_reward']}")
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å PPO

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | SAC | PPO |
|----------------|-----|-----|
| –¢–∏–ø –∞–ª–≥–æ—Ä–∏—Ç–º–∞ | Off-policy | On-policy |
| –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π | –¢–æ–ª—å–∫–æ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ | –î–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ |
| –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∫–∏ | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –í—ã—Å–æ–∫–∞—è | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è |
| –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ (—ç–Ω—Ç—Ä–æ–ø–∏—è) | –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| –ü–∞–º—è—Ç—å | –¢—Ä–µ–±—É–µ—Ç replay buffer | –ù–µ —Ç—Ä–µ–±—É–µ—Ç |

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SAC:
- ‚úÖ –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∫–∏
- ‚úÖ –ó–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ —Ö–æ—Ä–æ—à–µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PPO:
- ‚úÖ –î–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å
- ‚úÖ –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **–î–∏—Å–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π**
   ```
   ValueError: –ê–ª–≥–æ—Ä–∏—Ç–º SAC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PPO, A2C –∏–ª–∏ DQN

2. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å**
   - –£–≤–µ–ª–∏—á—å—Ç–µ `learning_starts`
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `ent_coef` –≤—Ä—É—á–Ω—É—é
   - –î–æ–±–∞–≤—å—Ç–µ —à—É–º –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

3. **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**
   - –£–º–µ–Ω—å—à–∏—Ç–µ `learning_rate`
   - –£–≤–µ–ª–∏—á—å—Ç–µ `batch_size`
   - –í–∫–ª—é—á–∏—Ç–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ä–µ–¥—ã

### –û—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
config = SACConfig(
    env_name="Pendulum-v1",
    verbose=2,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—Ä–µ–¥—ã
try:
    agent = SACAgent(config=config)
except ValueError as e:
    print(f"–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
```

## –ü—Ä–∏–º–µ—Ä—ã

–ü–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤:
- `examples/sac_agent_usage.py` - –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- `configs/sac_config.yaml` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `tests/unit/test_sac_agent.py` - –¢–µ—Å—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä—ã

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–¢–∏–ø–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ä–µ–¥:

| –°—Ä–µ–¥–∞ | –¶–µ–ª–µ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞ | –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è | –®–∞–≥–∏ |
|-------|----------------|----------------|------|
| Pendulum-v1 | -200 | ~5 –º–∏–Ω | 50K |
| LunarLander-v3 | 200 | ~15 –º–∏–Ω | 100K |
| BipedalWalker-v3 | 300 | ~2 —á–∞—Å–∞ | 1M |

*–í—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–æ –¥–ª—è CPU Intel i7, –º–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∂–µ–ª–µ–∑–∞.*